!function(t){"function"==typeof define&&define.amd?define(t):t()}(function(){"use strict";!function(t){var e={_initialized:!1,_endpoint:null,_sessionId:null,_userId:null,_sessionTimeout:18e5,_lastActivity:null,_boundHandlers:{},init:function(i){i&&i.endpoint?(this._initialized&&this._removeEventListeners(),this._endpoint=i.endpoint.replace(/\/$/,""),this._lastActivity=Date.now(),this._initSession(),this._initialized=!0,this._restoreUserId(),this._boundHandlers.visibilityChange=function(){"visible"===document.visibilityState&&e._checkSession()},this._boundHandlers.beforeUnload=function(){e._lastActivity=Date.now()},document.addEventListener("visibilitychange",this._boundHandlers.visibilityChange),t.addEventListener("beforeunload",this._boundHandlers.beforeUnload),console.log("Ultralytics initialized")):console.error("Ultralytics: endpoint is required")},_initSession:function(){var t=this._getStoredSession();t&&Date.now()-t.lastActivity<this._sessionTimeout?(this._sessionId=t.id,this._lastActivity=t.lastActivity):this._sessionId=this._generateId(),this._storeSession()},_checkSession:function(){(!this._lastActivity||Date.now()-this._lastActivity>this._sessionTimeout)&&(this._sessionId=this._generateId()),this._lastActivity=Date.now(),this._storeSession()},_generateId:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})},_storeSession:function(){try{localStorage.setItem("ultralytics_session",JSON.stringify({id:this._sessionId,lastActivity:this._lastActivity}))}catch(t){}},_getStoredSession:function(){try{var t=localStorage.getItem("ultralytics_session");return t?JSON.parse(t):null}catch(t){return null}},_restoreUserId:function(){try{var t=localStorage.getItem("ultralytics_user_id");t&&(this._userId=t)}catch(t){}},track:function(t,e){if(this._initialized){this._sessionId||(this._sessionId=this._generateId(),this._storeSession()),this._lastActivity=Date.now(),this._storeSession();var i={name:t,properties:e||{},sessionId:this._sessionId,userId:this._userId,timestamp:(new Date).toISOString()};this._send("/api/events",i)}else console.error("Ultralytics: not initialized. Call init() first.")},trackPageView:function(e){var i={url:t.location.href,path:t.location.pathname,title:document.title,referrer:document.referrer||null};if(e)for(var s in e)e.hasOwnProperty(s)&&(i[s]=e[s]);this.track("page_view",i)},_removeEventListeners:function(){this._boundHandlers.visibilityChange&&document.removeEventListener("visibilitychange",this._boundHandlers.visibilityChange),this._boundHandlers.beforeUnload&&t.removeEventListener("beforeunload",this._boundHandlers.beforeUnload),this._boundHandlers={}},destroy:function(){this._initialized&&(this._removeEventListeners(),this._initialized=!1,this._endpoint=null,this._sessionId=null,this._userId=null,console.log("Ultralytics destroyed"))},trackEvent:function(t,e){var i={eventType:"custom"};if(e)for(var s in e)e.hasOwnProperty(s)&&(i[s]=e[s]);this.track(t,i)},identify:function(t,e){if(this._initialized)if(t){this._userId=t;try{localStorage.setItem("ultralytics_user_id",t)}catch(t){}e&&this.track("identify",e),console.log("Ultralytics: user identified",t)}else console.error("Ultralytics: userId is required for identify()");else console.error("Ultralytics: not initialized. Call init() first.")},getUserId:function(){return this._userId},clearUser:function(){this._userId=null;try{localStorage.removeItem("ultralytics_user_id")}catch(t){}},trackBatch:function(t,e){if(!this._initialized){var i=new Error("Ultralytics: not initialized. Call init() first.");return console.error(i.message),void(e&&e(i))}if(!Array.isArray(t)||0===t.length){i=new Error("Ultralytics: events must be a non-empty array");return console.error(i.message),void(e&&e(i))}this._lastActivity=Date.now(),this._storeSession();var s=this,n=t.map(function(t){return{name:t.name,properties:t.properties||{},sessionId:s._sessionId,userId:s._userId,timestamp:t.timestamp||(new Date).toISOString()}});this._sendBatch(n,e)},_sendBatch:function(t,e){var i=new XMLHttpRequest;i.open("POST",this._endpoint+"/api/events/batch",!0),i.setRequestHeader("Content-Type","application/json"),i.onreadystatechange=function(){if(4===i.readyState)if(i.status>=200&&i.status<300){if(e)try{var t=JSON.parse(i.responseText);e(null,t)}catch(t){e(null,{success:!0})}}else{var s=new Error("Failed to send batch: "+i.status);console.error("Ultralytics: failed to send batch",i.status),e&&e(s)}},i.send(JSON.stringify({events:t}))},_send:function(t,e){var i=new XMLHttpRequest;i.open("POST",this._endpoint+t,!0),i.setRequestHeader("Content-Type","application/json"),i.onreadystatechange=function(){4===i.readyState&&(i.status>=200&&i.status<300||console.error("Ultralytics: failed to send event",i.status))},i.send(JSON.stringify(e))}};t.Ultralytics=e}(window)});
//# sourceMappingURL=ultralytics.min.js.map
